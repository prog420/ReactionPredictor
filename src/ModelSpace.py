import re
from dataclasses import dataclass


@dataclass
class TFModel:
    """
    Model Parameters
    """
    num_layers: int
    d_model: int
    num_heads: int
    dff: int
    vocab_size: int
    pe_input: int
    pe_target: int
    rate: float
    vocab: dict
    reduce_smiles: bool
    tokenizer: re.Pattern
    weights_uri: str


"""
Vocabulary for base model (MIT400K-CGRtools, mixed, augmented)
"""
smilesVocab = {'O': 1, '(': 2, 'C': 3, ')': 4, 'N': 5, '.': 6, '[Cl-]': 7, 'c': 8, '1': 9, 'n': 10, '2': 11, '3': 12,
               '=': 13, '>': 14, '[Li]': 15, 'Br': 16, '[K+]': 17, '[O-]': 18, 'F': 19, '[H-]': 20, '[H]': 21,
               '[Na+]': 22, '[NH3+]': 23, '[NH+]': 24, '[nH]': 25, '4': 26, 'S': 27, '[NH2+]': 28, 'Cl': 29, '-': 30,
               'o': 31, '[Br-]': 32, '[Mg+]': 33, '#': 34, '5': 35, '[I-]': 36, 'P': 37, '6': 38, '[Li+]': 39,
               '[N-]': 40, 's': 41, '[n+]': 42, '[N+]': 43, '[Na]': 44, '[F-]': 45, '[Si]': 46, '[Pd]': 47,
               '[NH4+]': 48, 'I': 49, '[nH+]': 50, '[BH4-]': 51, '[Cu]': 52, '[Al+3]': 53, '[Cs+]': 54, '[Pd+2]': 55,
               '[BH3-]': 56, 'B': 57, '[S-]': 58, '[PH+]': 59, '7': 60, '[P-]': 61, '[K]': 62, '[Fe]': 63, '[SiH]': 64,
               '[BH-]': 65, '[Mn]': 66, '[Cu+2]': 67, '[Pt]': 68, '[Zn]': 69, '[O+]': 70, '[B-]': 71, '[n-]': 72,
               '8': 73, '[CH-]': 74, '[GeH4]': 75, '[Zn+2]': 76, '[Mg]': 77, '[Cr]': 78, '[W]': 79, '[Sn]': 80,
               '[Ca+2]': 81, '[P+]': 82, '[Ca]': 83, '[Zn+]': 84, '[Se]': 85, '[Al]': 86, '[S+]': 87, '9': 88,
               '%10': 89, '[Co]': 90, '[SH-]': 91, '[Ag+]': 92, '[Yb+3]': 93, '[Fe+2]': 94, '[Mg+2]': 95, '[PH]': 96,
               '[SnH]': 97, '[se]': 98, '[Ni]': 99, '[Hg]': 100, '[SiH2]': 101, '[Au]': 102, '[Pb]': 103, '[Co+2]': 104,
               '[Cr+2]': 105, '[SH]': 106, '[C-]': 107, '[SiH3]': 108, '[As]': 109, '[Fe+3]': 110, '[Ti]': 111,
               '[H+]': 112, '[IH2]': 113, '[OH+]': 114, '[Cd+2]': 115, '[Ba+2]': 116, '[NH-]': 117, '[Os]': 118,
               '[In+3]': 119, '[Ni+2]': 120, '[cH-]': 121, '[TeH2]': 122, '[Ce+3]': 123, '%11': 124, '%12': 125,
               '%13': 126, '[Mn+2]': 127, '[Ce]': 128, '[Cr+3]': 129, '[In]': 130, '[Rh]': 131, '[GeH]': 132,
               '[Ge]': 133, '[Bi]': 134, '[Ir]': 135, '[Pb+2]': 136, '[Cs]': 137, '[Ag]': 138, '[Cd]': 139, '[c-]': 140,
               '[SiH4]': 141, '[Ru]': 142, '[Sc+3]': 143, '[V]': 144, '[V+3]': 145, '[Ar]': 146, '[Ba]': 147,
               '[Sn+]': 148, '[Mo]': 149, '[Xe]': 150, '[Sn+2]': 151, '[Y+3]': 152, 'p': 153, '[Sb]': 154, '%14': 155,
               '%15': 156, '[Se-]': 157, '[Tl]': 158, '[He]': 159, '[Dy+3]': 160, '[SeH]': 161, '[Sr+2]': 162,
               '[Sr]': 163, '[Tl+3]': 164, '[Sm]': 165, '[Ga+3]': 166, '[s+]': 167, '[Ta]': 168, '[Mn+3]': 169,
               '[Be+2]': 170, '[La+3]': 171, '[Ga]': 172, '[Re]': 173, '[o+]': 174, '[SeH-]': 175, '[Zr]': 176,
               '[Tl+]': 177, 'b': 178, '[Sc]': 179, '[Nd+3]': 180, '[Co+3]': 181, '[As+]': 182, '[Rb+]': 183,
               '[se+]': 184, '[Sm+3]': 185, '[Hf]': 186, '[Pr+3]': 187, '[GeH2]': 188, '[Au-]': 189, '[Yb]': 190,
               '[C+]': 191, 'pad': 0, 'SOS': 192}

"""
Vocabulary for base model (MIT400K-CGRtools, mixed, augmented)
"""
cgrVocab = {1: 'C', 2: '(', 3: '[Mg+]', 4: ')', 5: '.', 6: 'N', 7: 'O', 8: 'c', 9: '1', 10: 'n', 11: '[2]', 12: '=',
            13: '[4]', 14: '[Cl-]', 15: '[->.]', 16: '[3]', 17: '[.>-]', 18: '2', 19: '[N+]', 20: '[O-]', 21: 'Cl',
            22: '-', 23: '3', 24: 'F', 25: '4', 26: '[->=]', 27: '[=>.]', 28: '5', 29: '[5]', 30: 's', 31: '#', 32: 'S',
            33: '[nH]', 34: 'Br', 35: '[P-]', 36: '[BH4-]', 37: '[Na+]', 38: '[B-]', 39: '6', 40: '[=>-]', 41: 'I',
            42: '[S-]', 43: '[K+]', 44: '[S->0]', 45: '[Al]', 46: 'B', 47: '[Li]', 48: '[H-]', 49: '[.>=]', 50: '[OH-]',
            51: '[Zn]', 52: '[K]', 53: '[Al+]', 54: 'o', 55: '7', 56: '[Cl+]', 57: '[Na]', 58: '[I-]', 59: 'P',
            60: '[Pd+2]', 61: '8', 62: '[Al+3]', 63: '[Li+]', 64: '[Cs+]', 65: '[NH4+]', 66: '[7]', 67: '[6]',
            68: '[#>-]', 69: '[->#]', 70: '[N-]', 71: '[N->0]', 72: '[H]', 73: '[Pd]', 74: '[Si]', 75: '[SiH]',
            76: '[Cu+2]', 77: '[O0>-]', 78: '9', 79: '[Cu]', 80: '[Sn]', 81: '%10', 82: '%11', 83: '[N+>0]',
            84: '[O->0]', 85: '[11]', 86: '[18]', 87: '[8]', 88: '[10]', 89: '[12]', 90: '[9]', 91: '[13]', 92: '%12',
            93: '%13', 94: '%14', 95: '%15', 96: '%16', 97: '%17', 98: '[PH]', 99: '[Br-]', 100: '[BH-]', 101: '%18',
            102: '[#>=]', 103: '[BH3-]', 104: '[F-]', 105: '[C-]', 106: '[N0>+]', 107: '[Hg]', 108: '[Mn]', 109: '[Fe]',
            110: '[16]', 111: '[15]', 112: '[14]', 113: '[Ca+2]', 114: '[F->0]', 115: '[se]', 116: '[Cr]', 117: '[nH+]',
            118: '[n+]', 119: '[Mg+2]', 120: '[NH2+]', 121: '[Zn+2]', 122: '[I+3]', 123: '[Cl->0]', 124: '[P+]',
            125: '[Br0>-]', 126: '[#>.]', 127: '[Se]', 128: '[Pb]', 129: '[Ti+4]', 130: '[Mg]', 131: '[Cl0>-]',
            132: '[Mg0>+]', 133: '[Pt]', 134: '[I->0]', 135: '[Xe]', 136: '[C->0]', 137: '[NH+]', 138: '[n0>-]',
            139: '[Rh+]', 140: '[SH-]', 141: '[n0>+]', 142: '[Zn+]', 143: '[B+3]', 144: '[S+]', 145: '[.>#]',
            146: '[I0>-]', 147: '[Ag]', 148: '[Ru]', 149: '[Ce+3]', 150: '[Ce]', 151: '[O+]', 152: '[SnH]',
            153: '[Cl+3]', 154: '[KH]', 155: '[Pd-2]', 156: '[SH]', 157: '[AlH]', 158: '[Ba+2]', 159: '[Mn+2]',
            160: '[Co]', 161: '%19', 162: '[Ti+3]', 163: '[=>#]', 164: '[P0>+]', 165: '[SiH3]', 166: '[NH-]',
            167: '[Zr+2]', 168: '[Zr+2>+]', 169: '[NH2-]', 170: '[B+]', 171: '[Ag+]', 172: '[Si-]', 173: '[S0>-]',
            174: '[17]', 175: '[O]', 176: '[O*]', 177: '[CH-]', 178: '[19]', 179: '[Cu+]', 180: '[Sb]', 181: '[As]',
            182: '[Os]', 183: '[CH3]', 184: '[C*]', 185: '[Yb+3]', 186: 'b', 187: '[Ce+4]', 188: '[AlH4-]',
            189: '[Al-]', 190: '[Br->0]', 191: '[Rh]', 192: '[Nd+3]', 193: '[PH4+]', 194: '[n+>0]', 195: '[Ni]',
            196: '[Fe+2]', 197: '[Sc+3]', 198: '[SiH2]', 199: '[I+2]', 200: '[I+2>0]', 201: '[Ca]', 202: '[s0>+]',
            203: '%20', 204: '%21', 205: '[GeH]', 206: '[Ge]', 207: '[Fe+3]', 208: '[SiH4]', 209: '[Se-]', 210: '[Ti]',
            211: '[N0>-]', 212: '[S0>+]', 213: '[Ag+2]', 214: '[PH+]', 215: '[NH3+]', 216: '[H+]', 217: '[21]',
            218: '[Rh+3]', 219: '[Rh+2]', 220: '[I+]', 221: '[In+3]', 222: '[C+4]', 223: '[C]', 224: '[Cs]',
            225: '[CH2]', 226: '[n-]', 227: '[c-]', 228: '[CH2+]', 229: '[C+>0]', 230: '[Br+2]', 231: '[Br+2>0]',
            232: '[PH3+]', 233: '[20]', 234: '[Au-]', 235: '[Au->0]', 236: '[Nd]', 237: '[Nd0>+]', 238: '[AlH2-]',
            239: '[Zr+4]', 240: '[Ag-]', 241: '[I+3>0]', 242: '[OH]', 243: '[GeH4]', 244: '[Ti+]', 245: '[Li0>+]',
            246: '[W]', 247: '[27]', 248: '[24]', 249: '[22]', 250: '[28]', 251: '[26]', 252: '[Cu+2>0]', 253: '[Pt+3]',
            254: '[P+3]', 255: '[Te]', 256: '[Pb+4]', 257: '[Sn+2]', 258: '[RuH3]', 259: '[P+>0]', 260: '[C0>-]',
            261: '[Tl+]', 262: '[Ag0>+]', 263: '[Sn+]', 264: '[Sn+>0]', 265: '[In]', 266: '[Pd+]', 267: '[Pb+2]',
            268: '[S+>0]', 269: '[As+]', 270: '[Fe-3]', 271: '[IH+]', 272: '[C0>+]', 273: '[Sm+3]', 274: '[Cl+2]',
            275: '[Cl+2>0]', 276: '[LiH]', 277: '[N->+]', 278: '[CH2-]', 279: '[Re]', 280: '[SnH3]', 281: '[Ag+>0]',
            282: '[Se0>-]', 283: '[Ar]', 284: '[Cd+2]', 285: '[Dy+3]', 286: '[Pd-4]', 287: '[Tl]', 288: '[Hf+4]',
            289: '[Ir]', 290: '[Bi]', 291: '[Ti+4>+2]', 292: 'p', 293: '%22', 294: '%23', 295: '[Mg+2>0]',
            296: '[Ti+4>0]', 297: '[Sn+4]', 298: '[Mg+>0]', 299: '[Co+2]', 300: '[s+]', 301: '[s+>0]', 302: '[Mo]',
            303: '[Ni+2]', 304: '[Pr+3]', 305: '[Pd-]', 306: '[Zr]', 307: '[Sn0>+]', 308: '[Zn0>+]', 309: '[o+]',
            310: '[Ba+2>0]', 311: '[Tl+3]', 312: '[Ba]', 313: '[Zn+2>0]', 314: '[SnH4]', 315: '[Yb]', 316: '[Au]',
            317: '[B->0]', 318: '[Ca+2>0]', 319: '[o+>0]', 320: '[Na0>+]', 321: '[Hg+2]', 322: '[AlH3]', 323: '[IH2+]',
            324: '[I+>0]', 325: '[Mn+3]', 326: '[o0>+]', 327: '[SeH-]', 328: '[Sn0>+2]', 329: '[Cr+3]', 330: '[Cr+3>0]',
            331: '[N]', 332: '[N*]', 333: '[Al+2]', 334: '[Sm+2]', 335: '[Sm]', 336: '[SnH2]', 337: '[Ga]',
            338: '[Ga+]', 339: '[Ga+>0]', 340: '[V+4]', 341: '[IH2+3]', 342: '[PdH2]', 343: '[Ag+2>+]', 344: '[23]',
            345: '[Ta+2]', 346: '[Ta+2>0]', 347: '[Co0>+2]', 348: '[c+]', 349: '[La]', 350: '[He]', 351: '[F0>-]',
            352: '[Co+]', 353: '[PH2+]', 354: '[25]', 355: '[Al+3>0]', 356: '[Tl+2]', 357: '[Sc]', 358: '[K+>0]',
            359: '[Sn+>+2]', 360: '[Li+>0]', 361: '[O0>+]', 362: '[c+>0]', 363: '[c0>+]', 364: '[n->0]',
            365: '[Ti+4>+3]', 366: '[Cu+3]', 367: '[La+3]', 368: '[Fe-4]', 369: '[Rb+]', 370: '[Pb+3]', 371: '[Al+>0]',
            372: '[Cl+>0]', 373: '[Br+]', 374: '[Br+>0]', 375: '[Cr+2]', 376: '[Pt+2]', 377: '[29]', 378: '[Hf]',
            379: '[SH3+]', 380: '[N+3]', 381: '[Ga+2]', 382: '[Ga+2>0]', 383: '[OH+]', 384: '[O+>0]', 385: '[I0>+]',
            386: '[Zn+2>+]', 387: '[Pb+4>+2]', 388: '[Ru-2]', 389: '[Cd]', 390: '[Y+3]', 391: '[Hg+]', 392: '[Na+>0]',
            393: '[Mn+2>0]', 394: '[Pb+4>+3]', 395: '[Ru+2]', 396: '[Ta]', 397: '[In0>+]', 398: '[OH2+]', 399: '[C+]',
            400: '[Ga+3]', 401: '[Bi+3]', 402: '[Co+3]', 403: '[V]', 404: '[Ni+3]', 405: '[Be+2]', 406: '[V+3]',
            407: '[Eu+3]', 408: '[c0>-]', 409: '%24', 410: '%25', 411: '%26', 412: '[Cd+2>+]', 413: '[SeH]',
            414: '[Ni+]', 415: '[SH+]', 416: '[CH+]', 417: '[30]', 418: '[31]', 419: '[34]', 420: '[Pd+2>0]',
            421: '[Ti+2]', 422: '[Ce+2]', 423: '[Zr+4>+3]', 424: '[B+2]', 425: '[Pt-]', 426: '[Sr+2]', 427: '[Sr+2>0]',
            428: '[SH2+]', 429: '[Zr+4>0]', 430: '[Ca0>+2]', 431: '[Ti+2>0]', 432: '[Zr+]', 433: '[Zr+>0]',
            434: '[sH+]', 435: '[Mg+2>+]', 436: '[Si+]', 437: '[Sn+3]', 0: 'pad', 438: 'SOS'}

"""
Tokenizer (re.Pattern) for SMILES and CGR models
"""
tokenizer = re.compile(
        r'(\[[^\]]+]|Br?|Cl?|N|O|S|P|F|I|b|c|n|o|s|se?|p|\(|\)|\.|=|#|'
        r'-|\+|\\\\|\/|:|~|@|\?|>|>>|\*|\$|\%[0-9]{2}|[0-9])'
)

"""
Base Model (MIT400K-CGRtools, mixed, augmented 1:5)
String accuracy:
top-1: 35.66%
top-5: 89.61%
Mol accuracy:
top-1: 38.37%
top-5: 91.09%
"""
SmilesModel = TFModel(num_layers=4, d_model=256, num_heads=8, dff=1024,
                      vocab_size=193, pe_input=130, pe_target=80, rate=0.1,
                      vocab=smilesVocab, reduce_smiles=False, tokenizer=tokenizer,
                      weights_uri='data://.my/TFModel/tf_MIT400K_mixed.h5')


"""
CGR Model (SMILES -> CGRs, reduced smiles, augmented 1:5)
String accuracy:
top-1: 20.21%
top-5: 50.17%
Mol accuracy:
top-1: 77.33%
top-5: 86.01%
"""
CgrModel = TFModel(num_layers=4, d_model=256, num_heads=8, dff=1024,
                   vocab_size=439, pe_input=150, pe_target=150, rate=0.1,
                   vocab=cgrVocab, reduce_smiles=True, tokenizer=tokenizer,
                   weights_uri='data://.my/TFModel/tf_CGR_reduced.h5')
