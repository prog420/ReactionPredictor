import re
from dataclasses import dataclass


@dataclass
class TFModel:
    """
    Model Parameters
    """
    num_layers: int
    d_model: int
    num_heads: int
    dff: int
    vocab_size: int
    pe_input: int
    pe_target: int
    rate: float
    vocab: dict
    reduce_smiles: bool
    tokenizer: re.Pattern
    weights_uri: str


"""
Vocabulary for base model (MIT400K-CGRtools, mixed, augmented)
"""
smilesVocab = {'O': 1, '(': 2, 'C': 3, ')': 4, 'N': 5, '.': 6, '[Cl-]': 7, 'c': 8, '1': 9, 'n': 10, '2': 11, '3': 12,
               '=': 13, '>': 14, '[Li]': 15, 'Br': 16, '[K+]': 17, '[O-]': 18, 'F': 19, '[H-]': 20, '[H]': 21,
               '[Na+]': 22, '[NH3+]': 23, '[NH+]': 24, '[nH]': 25, '4': 26, 'S': 27, '[NH2+]': 28, 'Cl': 29, '-': 30,
               'o': 31, '[Br-]': 32, '[Mg+]': 33, '#': 34, '5': 35, '[I-]': 36, 'P': 37, '6': 38, '[Li+]': 39,
               '[N-]': 40, 's': 41, '[n+]': 42, '[N+]': 43, '[Na]': 44, '[F-]': 45, '[Si]': 46, '[Pd]': 47,
               '[NH4+]': 48, 'I': 49, '[nH+]': 50, '[BH4-]': 51, '[Cu]': 52, '[Al+3]': 53, '[Cs+]': 54, '[Pd+2]': 55,
               '[BH3-]': 56, 'B': 57, '[S-]': 58, '[PH+]': 59, '7': 60, '[P-]': 61, '[K]': 62, '[Fe]': 63, '[SiH]': 64,
               '[BH-]': 65, '[Mn]': 66, '[Cu+2]': 67, '[Pt]': 68, '[Zn]': 69, '[O+]': 70, '[B-]': 71, '[n-]': 72,
               '8': 73, '[CH-]': 74, '[GeH4]': 75, '[Zn+2]': 76, '[Mg]': 77, '[Cr]': 78, '[W]': 79, '[Sn]': 80,
               '[Ca+2]': 81, '[P+]': 82, '[Ca]': 83, '[Zn+]': 84, '[Se]': 85, '[Al]': 86, '[S+]': 87, '9': 88,
               '%10': 89, '[Co]': 90, '[SH-]': 91, '[Ag+]': 92, '[Yb+3]': 93, '[Fe+2]': 94, '[Mg+2]': 95, '[PH]': 96,
               '[SnH]': 97, '[se]': 98, '[Ni]': 99, '[Hg]': 100, '[SiH2]': 101, '[Au]': 102, '[Pb]': 103, '[Co+2]': 104,
               '[Cr+2]': 105, '[SH]': 106, '[C-]': 107, '[SiH3]': 108, '[As]': 109, '[Fe+3]': 110, '[Ti]': 111,
               '[H+]': 112, '[IH2]': 113, '[OH+]': 114, '[Cd+2]': 115, '[Ba+2]': 116, '[NH-]': 117, '[Os]': 118,
               '[In+3]': 119, '[Ni+2]': 120, '[cH-]': 121, '[TeH2]': 122, '[Ce+3]': 123, '%11': 124, '%12': 125,
               '%13': 126, '[Mn+2]': 127, '[Ce]': 128, '[Cr+3]': 129, '[In]': 130, '[Rh]': 131, '[GeH]': 132,
               '[Ge]': 133, '[Bi]': 134, '[Ir]': 135, '[Pb+2]': 136, '[Cs]': 137, '[Ag]': 138, '[Cd]': 139, '[c-]': 140,
               '[SiH4]': 141, '[Ru]': 142, '[Sc+3]': 143, '[V]': 144, '[V+3]': 145, '[Ar]': 146, '[Ba]': 147,
               '[Sn+]': 148, '[Mo]': 149, '[Xe]': 150, '[Sn+2]': 151, '[Y+3]': 152, 'p': 153, '[Sb]': 154, '%14': 155,
               '%15': 156, '[Se-]': 157, '[Tl]': 158, '[He]': 159, '[Dy+3]': 160, '[SeH]': 161, '[Sr+2]': 162,
               '[Sr]': 163, '[Tl+3]': 164, '[Sm]': 165, '[Ga+3]': 166, '[s+]': 167, '[Ta]': 168, '[Mn+3]': 169,
               '[Be+2]': 170, '[La+3]': 171, '[Ga]': 172, '[Re]': 173, '[o+]': 174, '[SeH-]': 175, '[Zr]': 176,
               '[Tl+]': 177, 'b': 178, '[Sc]': 179, '[Nd+3]': 180, '[Co+3]': 181, '[As+]': 182, '[Rb+]': 183,
               '[se+]': 184, '[Sm+3]': 185, '[Hf]': 186, '[Pr+3]': 187, '[GeH2]': 188, '[Au-]': 189, '[Yb]': 190,
               '[C+]': 191, 'pad': 0, 'SOS': 192}

"""
Vocabulary for base model (MIT400K-CGRtools, mixed, augmented)
"""
cgrVocab = {'C': 1, '(': 2, '[Mg+]': 3, ')': 4, '.': 5, 'N': 6, 'O': 7, 'c': 8, '1': 9, 'n': 10, '[2]': 11, '=': 12,
            '[4]': 13, '[Cl-]': 14, '[->.]': 15, '[3]': 16, '[.>-]': 17, '2': 18, '[N+]': 19, '[O-]': 20, 'Cl': 21,
            '-': 22, '3': 23, 'F': 24, '4': 25, '[->=]': 26, '[=>.]': 27, '5': 28, '[5]': 29, 's': 30, '#': 31, 'S': 32,
            '[nH]': 33, 'Br': 34, '[P-]': 35, '[BH4-]': 36, '[Na+]': 37, '[B-]': 38, '6': 39, '[=>-]': 40, 'I': 41,
            '[S-]': 42, '[K+]': 43, '[S->0]': 44, '[Al]': 45, 'B': 46, '[Li]': 47, '[H-]': 48, '[.>=]': 49, '[OH-]': 50,
            '[Zn]': 51, '[K]': 52, '[Al+]': 53, 'o': 54, '7': 55, '[Cl+]': 56, '[Na]': 57, '[I-]': 58, 'P': 59,
            '[Pd+2]': 60, '8': 61, '[Al+3]': 62, '[Li+]': 63, '[Cs+]': 64, '[NH4+]': 65, '[7]': 66, '[6]': 67,
            '[#>-]': 68, '[->#]': 69, '[N-]': 70, '[N->0]': 71, '[H]': 72, '[Pd]': 73, '[Si]': 74, '[SiH]': 75,
            '[Cu+2]': 76, '[O0>-]': 77, '9': 78, '[Cu]': 79, '[Sn]': 80, '%10': 81, '%11': 82, '[N+>0]': 83,
            '[O->0]': 84, '[11]': 85, '[18]': 86, '[8]': 87, '[10]': 88, '[12]': 89, '[9]': 90, '[13]': 91, '%12': 92,
            '%13': 93, '%14': 94, '%15': 95, '%16': 96, '%17': 97, '[PH]': 98, '[Br-]': 99, '[BH-]': 100, '%18': 101,
            '[#>=]': 102, '[BH3-]': 103, '[F-]': 104, '[C-]': 105, '[N0>+]': 106, '[Hg]': 107, '[Mn]': 108, '[Fe]': 109,
            '[16]': 110, '[15]': 111, '[14]': 112, '[Ca+2]': 113, '[F->0]': 114, '[se]': 115, '[Cr]': 116, '[nH+]': 117,
            '[n+]': 118, '[Mg+2]': 119, '[NH2+]': 120, '[Zn+2]': 121, '[I+3]': 122, '[Cl->0]': 123, '[P+]': 124,
            '[Br0>-]': 125, '[#>.]': 126, '[Se]': 127, '[Pb]': 128, '[Ti+4]': 129, '[Mg]': 130, '[Cl0>-]': 131,
            '[Mg0>+]': 132, '[Pt]': 133, '[I->0]': 134, '[Xe]': 135, '[C->0]': 136, '[NH+]': 137, '[n0>-]': 138,
            '[Rh+]': 139, '[SH-]': 140, '[n0>+]': 141, '[Zn+]': 142, '[B+3]': 143, '[S+]': 144, '[.>#]': 145,
            '[I0>-]': 146, '[Ag]': 147, '[Ru]': 148, '[Ce+3]': 149, '[Ce]': 150, '[O+]': 151, '[SnH]': 152,
            '[Cl+3]': 153, '[KH]': 154, '[Pd-2]': 155, '[SH]': 156, '[AlH]': 157, '[Ba+2]': 158, '[Mn+2]': 159,
            '[Co]': 160, '%19': 161, '[Ti+3]': 162, '[=>#]': 163, '[P0>+]': 164, '[SiH3]': 165, '[NH-]': 166,
            '[Zr+2]': 167, '[Zr+2>+]': 168, '[NH2-]': 169, '[B+]': 170, '[Ag+]': 171, '[Si-]': 172, '[S0>-]': 173,
            '[17]': 174, '[O]': 175, '[O*]': 176, '[CH-]': 177, '[19]': 178, '[Cu+]': 179, '[Sb]': 180, '[As]': 181,
            '[Os]': 182, '[CH3]': 183, '[C*]': 184, '[Yb+3]': 185, 'b': 186, '[Ce+4]': 187, '[AlH4-]': 188,
            '[Al-]': 189, '[Br->0]': 190, '[Rh]': 191, '[Nd+3]': 192, '[PH4+]': 193, '[n+>0]': 194, '[Ni]': 195,
            '[Fe+2]': 196, '[Sc+3]': 197, '[SiH2]': 198, '[I+2]': 199, '[I+2>0]': 200, '[Ca]': 201, '[s0>+]': 202,
            '%20': 203, '%21': 204, '[GeH]': 205, '[Ge]': 206, '[Fe+3]': 207, '[SiH4]': 208, '[Se-]': 209, '[Ti]': 210,
            '[N0>-]': 211, '[S0>+]': 212, '[Ag+2]': 213, '[PH+]': 214, '[NH3+]': 215, '[H+]': 216, '[21]': 217,
            '[Rh+3]': 218, '[Rh+2]': 219, '[I+]': 220, '[In+3]': 221, '[C+4]': 222, '[C]': 223, '[Cs]': 224,
            '[CH2]': 225, '[n-]': 226, '[c-]': 227, '[CH2+]': 228, '[C+>0]': 229, '[Br+2]': 230, '[Br+2>0]': 231,
            '[PH3+]': 232, '[20]': 233, '[Au-]': 234, '[Au->0]': 235, '[Nd]': 236, '[Nd0>+]': 237, '[AlH2-]': 238,
            '[Zr+4]': 239, '[Ag-]': 240, '[I+3>0]': 241, '[OH]': 242, '[GeH4]': 243, '[Ti+]': 244, '[Li0>+]': 245,
            '[W]': 246, '[27]': 247, '[24]': 248, '[22]': 249, '[28]': 250, '[26]': 251, '[Cu+2>0]': 252,
            '[Pt+3]': 253, '[P+3]': 254, '[Te]': 255, '[Pb+4]': 256, '[Sn+2]': 257, '[RuH3]': 258, '[P+>0]': 259,
            '[C0>-]': 260, '[Tl+]': 261, '[Ag0>+]': 262, '[Sn+]': 263, '[Sn+>0]': 264, '[In]': 265, '[Pd+]': 266,
            '[Pb+2]': 267, '[S+>0]': 268, '[As+]': 269, '[Fe-3]': 270, '[IH+]': 271, '[C0>+]': 272, '[Sm+3]': 273,
            '[Cl+2]': 274, '[Cl+2>0]': 275, '[LiH]': 276, '[N->+]': 277, '[CH2-]': 278, '[Re]': 279, '[SnH3]': 280,
            '[Ag+>0]': 281, '[Se0>-]': 282, '[Ar]': 283, '[Cd+2]': 284, '[Dy+3]': 285, '[Pd-4]': 286, '[Tl]': 287,
            '[Hf+4]': 288, '[Ir]': 289, '[Bi]': 290, '[Ti+4>+2]': 291, 'p': 292, '%22': 293, '%23': 294,
            '[Mg+2>0]': 295, '[Ti+4>0]': 296, '[Sn+4]': 297, '[Mg+>0]': 298, '[Co+2]': 299, '[s+]': 300, '[s+>0]': 301,
            '[Mo]': 302, '[Ni+2]': 303, '[Pr+3]': 304, '[Pd-]': 305, '[Zr]': 306, '[Sn0>+]': 307, '[Zn0>+]': 308,
            '[o+]': 309, '[Ba+2>0]': 310, '[Tl+3]': 311, '[Ba]': 312, '[Zn+2>0]': 313, '[SnH4]': 314, '[Yb]': 315,
            '[Au]': 316, '[B->0]': 317, '[Ca+2>0]': 318, '[o+>0]': 319, '[Na0>+]': 320, '[Hg+2]': 321, '[AlH3]': 322,
            '[IH2+]': 323, '[I+>0]': 324, '[Mn+3]': 325, '[o0>+]': 326, '[SeH-]': 327, '[Sn0>+2]': 328, '[Cr+3]': 329,
            '[Cr+3>0]': 330, '[N]': 331, '[N*]': 332, '[Al+2]': 333, '[Sm+2]': 334, '[Sm]': 335, '[SnH2]': 336,
            '[Ga]': 337, '[Ga+]': 338, '[Ga+>0]': 339, '[V+4]': 340, '[IH2+3]': 341, '[PdH2]': 342, '[Ag+2>+]': 343,
            '[23]': 344, '[Ta+2]': 345, '[Ta+2>0]': 346, '[Co0>+2]': 347, '[c+]': 348, '[La]': 349, '[He]': 350,
            '[F0>-]': 351, '[Co+]': 352, '[PH2+]': 353, '[25]': 354, '[Al+3>0]': 355, '[Tl+2]': 356, '[Sc]': 357,
            '[K+>0]': 358, '[Sn+>+2]': 359, '[Li+>0]': 360, '[O0>+]': 361, '[c+>0]': 362, '[c0>+]': 363, '[n->0]': 364,
            '[Ti+4>+3]': 365, '[Cu+3]': 366, '[La+3]': 367, '[Fe-4]': 368, '[Rb+]': 369, '[Pb+3]': 370, '[Al+>0]': 371,
            '[Cl+>0]': 372, '[Br+]': 373, '[Br+>0]': 374, '[Cr+2]': 375, '[Pt+2]': 376, '[29]': 377, '[Hf]': 378,
            '[SH3+]': 379, '[N+3]': 380, '[Ga+2]': 381, '[Ga+2>0]': 382, '[OH+]': 383, '[O+>0]': 384, '[I0>+]': 385,
            '[Zn+2>+]': 386, '[Pb+4>+2]': 387, '[Ru-2]': 388, '[Cd]': 389, '[Y+3]': 390, '[Hg+]': 391, '[Na+>0]': 392,
            '[Mn+2>0]': 393, '[Pb+4>+3]': 394, '[Ru+2]': 395, '[Ta]': 396, '[In0>+]': 397, '[OH2+]': 398, '[C+]': 399,
            '[Ga+3]': 400, '[Bi+3]': 401, '[Co+3]': 402, '[V]': 403, '[Ni+3]': 404, '[Be+2]': 405, '[V+3]': 406,
            '[Eu+3]': 407, '[c0>-]': 408, '%24': 409, '%25': 410, '%26': 411, '[Cd+2>+]': 412, '[SeH]': 413,
            '[Ni+]': 414, '[SH+]': 415, '[CH+]': 416, '[30]': 417, '[31]': 418, '[34]': 419, '[Pd+2>0]': 420,
            '[Ti+2]': 421, '[Ce+2]': 422, '[Zr+4>+3]': 423, '[B+2]': 424, '[Pt-]': 425, '[Sr+2]': 426, '[Sr+2>0]': 427,
            '[SH2+]': 428, '[Zr+4>0]': 429, '[Ca0>+2]': 430, '[Ti+2>0]': 431, '[Zr+]': 432, '[Zr+>0]': 433,
            '[sH+]': 434, '[Mg+2>+]': 435, '[Si+]': 436, '[Sn+3]': 437, 'pad': 0, 'SOS': 438}

"""
Tokenizer (re.Pattern) for SMILES and CGR models
"""
tokenizer = re.compile(
        r'(\[[^\]]+]|Br?|Cl?|N|O|S|P|F|I|b|c|n|o|s|se?|p|\(|\)|\.|=|#|'
        r'-|\+|\\\\|\/|:|~|@|\?|>|>>|\*|\$|\%[0-9]{2}|[0-9])'
)

"""
Base Model (MIT400K-CGRtools, mixed, augmented 1:5)
String accuracy:
top-1: 35.66%
top-5: 89.61%
Mol accuracy:
top-1: 38.37%
top-5: 91.09%
"""
SmilesModel = TFModel(num_layers=4, d_model=256, num_heads=8, dff=1024,
                      vocab_size=193, pe_input=130, pe_target=80, rate=0.1,
                      vocab=smilesVocab, reduce_smiles=False, tokenizer=tokenizer,
                      weights_uri='data://.my/TFModel/tf_MIT400K_mixed.h5')


"""
CGR Model (SMILES -> CGRs, reduced smiles, augmented 1:5)
String accuracy:
top-1: 20.21%
top-5: 50.17%
Mol accuracy:
top-1: 77.33%
top-5: 86.01%
"""
CgrModel = TFModel(num_layers=4, d_model=256, num_heads=8, dff=1024,
                   vocab_size=439, pe_input=150, pe_target=150, rate=0.1,
                   vocab=cgrVocab, reduce_smiles=True, tokenizer=tokenizer,
                   weights_uri='data://.my/TFModel/tf_CGR_reduced.h5')
